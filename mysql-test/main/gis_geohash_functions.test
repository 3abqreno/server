--echo #
--echo # Start of 11.5 tests
--echo #

--echo #
--echo # MDEV-17398 Implement Geographic functions available in MySQL 8.0
--echo #


#####################################################################
# ST_LONGFROMGEOHASH() 
#####################################################################


# Check for all valid characters and inputs
--echo # valid characters
SELECT ST_LONGFROMGEOHASH("0");

SELECT ST_LONGFROMGEOHASH("z");

SELECT ST_LONGFROMGEOHASH("0z");

SELECT ST_LONGFROMGEOHASH("upbp");

SELECT ST_LONGFROMGEOHASH("h000");

SELECT ST_LONGFROMGEOHASH("s000");

SELECT ST_LONGFROMGEOHASH("0123456789");

SELECT ST_LONGFROMGEOHASH("9876543210");

SELECT ST_LONGFROMGEOHASH("bcdefghjkmnpqrstuvwxyz");

SELECT ST_LONGFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb");

SELECT ST_LONGFROMGEOHASH("zzzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("pbpbpbpbpbpbpbpbpbpb");

SELECT ST_LONGFROMGEOHASH("bpbpbpbpbpbpbpbpbpbp");

SELECT ST_LONGFROMGEOHASH("00000000000000000000");

SELECT ST_LONGFROMGEOHASH("rzzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("2pbpbpbpbpbpbpbpbpbp");

SELECT ST_LONGFROMGEOHASH("7zzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("gzzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("5bpbpbpbpbpbpbpbpbpb");

SELECT ST_LONGFROMGEOHASH("0000000000zzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("zzzzzzzzzz0000000000");

SELECT ST_LONGFROMGEOHASH("s000000001z7wsg7zzm6");

SELECT ST_LONGFROMGEOHASH("kpbpbpbpbnpkqe5kpbtm");

SELECT ST_LONGFROMGEOHASH("ebpbpbpbpcbe9kuebp6d");

SELECT ST_LONGFROMGEOHASH("7zzzzzzzzy0s37hs00dt");

SELECT ST_LONGFROMGEOHASH("tzzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("jzzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("9zzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("1zzzzzzzzzzzzzzzzzzz");

SELECT ST_LONGFROMGEOHASH("ypzpgxczbzurypzpgxcz");

SELECT ST_LONGFROMGEOHASH("czbzurypzpgxczbzuryp");

SELECT ST_LONGFROMGEOHASH("0z0z0z0z0z0z0z0z0z0z0z0z0z0z0z0z");

SELECT ST_LONGFROMGEOHASH("0123456789bcdefghjkmnpqrstuvwxyz");

SELECT ST_LONGFROMGEOHASH("0123456789BCDEFGHJKMNPQRSTUVWXYZ");

SELECT ST_LONGFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb9876543210");

SELECT ST_LONGFROMGEOHASH("ZYXWVUTSRQPNMKJHGFEDCB9876543210");

SELECT ST_LONGFROMGEOHASH("1e1");

SELECT ST_LONGFROMGEOHASH("100");

SELECT ST_LONGFROMGEOHASH(CAST(100 AS CHAR));

SELECT ST_LONGFROMGEOHASH("10111000110001111001");

SELECT ST_LONGFROMGEOHASH("11111111111111111111");

SELECT ST_LONGFROMGEOHASH("99999999999999999999");

SELECT ST_LONGFROMGEOHASH(NULL);

SELECT ST_LONGFROMGEOHASH(null);

# Invalid characters and inputs 
--echo # invalid characters and inputs
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("0123a45");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("xyzi");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("zyxLwv");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("bcdjo");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("zyx**wv");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("1 2 3 4");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("1''2345");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("12.345");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("   ");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("NULL");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("-100");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH("");

--error ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
SELECT ST_LONGFROMGEOHASH();

--error ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
SELECT ST_LONGFROMGEOHASH("123","456");

--error ER_PARSE_ERROR
SELECT ST_LONGFROMGEOHASH("123",);

--error ER_PARSE_ERROR
SELECT ST_LONGFROMGEOHASH(,"456");

--error ER_PARSE_ERROR
SELECT ST_LONGFROMGEOHASH(,);

--error ER_PARSE_ERROR
SELECT ST_LONGFROMGEOHASH("0123456"789);

--error ER_BAD_FIELD_ERROR
SELECT ST_LONGFROMGEOHASH(abcdef);

# Test geohashes that are long
--echo # very long geohash
SELECT ST_LONGFROMGEOHASH("0123456789bcdefghjkmnpqrstuvwxyz0123456789bcdefghjkm"
                          "npqrstuvwxyz0123456789bcdefghjkmnpqrstuvwxyz01234567"
                          "89bcdefghjkmnpqrstuvwxyz");

SELECT ST_LONGFROMGEOHASH("0123456789BCDEFGHJKMNPQRSTUVWXYZ0123456789BCDEFGHJKM"
                          "NPQRSTUVWXYZ0123456789BCDEFGHJKMNPQRSTUVWXYZ01234567"
                          "89BCDEFGHJKMNPQRSTUVWXYZ");

SELECT ST_LONGFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb9876543210zyxwvutsrqpnmkjhgfed"
                          "cb9876543210zyxwvutsrqpnmkjhgfedcb9876543210zyxwvuts"
                          "rqpnmkjhgfedcb9876543210");

SELECT ST_LONGFROMGEOHASH("ZYXWVUTSRQPNMKJHGFEDCB9876543210ZYXWVUTSRQPNMKJHGFED"
                          "CB9876543210ZYXWVUTSRQPNMKJHGFEDCB9876543210ZYXWVUTS"
                          "RQPNMKJHGFEDCB9876543210");

# Table with different extreme values
CREATE TABLE geohashes  (gid INT NOT NULL PRIMARY KEY, hash_value VARCHAR(255));
INSERT INTO geohashes VALUES
  (1, "000000000000000000000"),
  (2, "zzzzzzzzzzzzzzzzzzzzz"),
  (3, NULL),
  (4, "s00t"),
  (5, "7zzzm"),
  (6, "s00d"),
  (7, "0"),
  (8, "z"),
  (9, "3ejh6z75ddt2d839zh2u"),
  (10, "twtsuqg3q7vh3nrbt0nn"),
  (11, "yw8s10dxddhe4s06nsph"),
  (12, "h4g4h9yrjtgzvewxm0ru"),
  (13, "9kqbredcnhq1b44ue48s"),
  (14, "1pckwjkqw3km0v6ye5d2"),
  (15, "wm313fnr92ggsysm64e6"),
  (16, "vqghx20fx6d8r5vfkbgf"),
  (17, "wvetm3u23kr9r6663k31"),
  (18, "e5t2p7sk291vpyb08pwu");

--echo # different random geohash values
SELECT ST_LONGFROMGEOHASH(hash_value) FROM geohashes;

#####################################################################
# ST_LATFROMGEOHASH() 
#####################################################################

# Check for all valid characters and inputs
--echo # valid characters
SELECT ST_LATFROMGEOHASH("0");

SELECT ST_LATFROMGEOHASH("z");

SELECT ST_LATFROMGEOHASH("0z");

SELECT ST_LATFROMGEOHASH("xbpb");

SELECT ST_LATFROMGEOHASH("8000");

SELECT ST_LATFROMGEOHASH("s000");

SELECT ST_LATFROMGEOHASH("0123456789");

SELECT ST_LATFROMGEOHASH("9876543210");

SELECT ST_LATFROMGEOHASH("bcdefghjkmnpqrstuvwxyz");

SELECT ST_LATFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb");

SELECT ST_LATFROMGEOHASH("zzzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("bpbpbpbpbpbpbpbpbpbp");

SELECT ST_LATFROMGEOHASH("pbpbpbpbpbpbpbpbpbpb");

SELECT ST_LATFROMGEOHASH("00000000000000000000");

SELECT ST_LATFROMGEOHASH("gzzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("5bpbpbpbpbpbpbpbpbpb");

SELECT ST_LATFROMGEOHASH("7zzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("rzzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("2pbpbpbpbpbpbpbpbpbp");

SELECT ST_LATFROMGEOHASH("0000000000zzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("zzzzzzzzzz0000000000");

SELECT ST_LATFROMGEOHASH("s000000001z7wsg7zzm6");

SELECT ST_LATFROMGEOHASH("ebpbpbpbpcbe9kuebp6d");

SELECT ST_LATFROMGEOHASH("kpbpbpbpbnpkqe5kpbtm");

SELECT ST_LATFROMGEOHASH("7zzzzzzzzy0s37hs00dt");

SELECT ST_LATFROMGEOHASH("tzzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("9zzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("jzzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("1zzzzzzzzzzzzzzzzzzz");

SELECT ST_LATFROMGEOHASH("zbzurypzpgxczbzurypz");

SELECT ST_LATFROMGEOHASH("5zpgxczbzurypzpgxczb");

SELECT ST_LATFROMGEOHASH("0z0z0z0z0z0z0z0z0z0z0z0z0z0z0z0z");

SELECT ST_LATFROMGEOHASH("0123456789bcdefghjkmnpqrstuvwxyz");

SELECT ST_LATFROMGEOHASH("0123456789BCDEFGHJKMNPQRSTUVWXYZ");

SELECT ST_LATFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb9876543210");

SELECT ST_LATFROMGEOHASH("ZYXWVUTSRQPNMKJHGFEDCB9876543210");

SELECT ST_LATFROMGEOHASH("1e1");

SELECT ST_LATFROMGEOHASH("100");

SELECT ST_LATFROMGEOHASH(CAST(100 AS CHAR));

SELECT ST_LATFROMGEOHASH("10111000110001111001");

SELECT ST_LATFROMGEOHASH("11111111111111111111");

SELECT ST_LATFROMGEOHASH("99999999999999999999");

SELECT ST_LATFROMGEOHASH(NULL);

SELECT ST_LATFROMGEOHASH(null);

# Invalid characters and inputs 
--echo # invalid characters and inputs
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("0123a45");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("xyzi");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("zyxLwv");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("bcdjo");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("zyx**wv");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("1 2 3 4");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("1''2345");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("12.345");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("   ");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("NULL");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("-100");

--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH("");

--error ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
SELECT ST_LATFROMGEOHASH();

--error ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
SELECT ST_LATFROMGEOHASH("123","456");

--error ER_PARSE_ERROR
SELECT ST_LATFROMGEOHASH("123",);

--error ER_PARSE_ERROR
SELECT ST_LATFROMGEOHASH(,"456");

--error ER_PARSE_ERROR
SELECT ST_LATFROMGEOHASH(,);

--error ER_PARSE_ERROR
SELECT ST_LATFROMGEOHASH("0123456"789);

--error ER_BAD_FIELD_ERROR
SELECT ST_LATFROMGEOHASH(abcdef);

# Test geohashes that are long
--echo # very long geohash
SELECT ST_LATFROMGEOHASH("0123456789bcdefghjkmnpqrstuvwxyz0123456789bcdefghjkmn"
                         "pqrstuvwxyz0123456789bcdefghjkmnpqrstuvwxyz0123456789"
                         "bcdefghjkmnpqrstuvwxyz");

SELECT ST_LATFROMGEOHASH("0123456789BCDEFGHJKMNPQRSTUVWXYZ0123456789BCDEFGHJKMN"
                         "PQRSTUVWXYZ0123456789BCDEFGHJKMNPQRSTUVWXYZ0123456789"
                         "BCDEFGHJKMNPQRSTUVWXYZ");

SELECT ST_LATFROMGEOHASH("zyxwvutsrqpnmkjhgfedcb9876543210zyxwvutsrqpnmkjhgfedc"
                         "b9876543210zyxwvutsrqpnmkjhgfedcb9876543210zyxwvutsrq"
                         "pnmkjhgfedcb9876543210");

SELECT ST_LATFROMGEOHASH("ZYXWVUTSRQPNMKJHGFEDCB9876543210ZYXWVUTSRQPNMKJHGFEDC"
                         "B9876543210ZYXWVUTSRQPNMKJHGFEDCB9876543210ZYXWVUTSRQ"
                         "PNMKJHGFEDCB9876543210");

--echo # different random geohash values
SELECT ST_LATFROMGEOHASH(hash_value) FROM geohashes;


SELECT
  ST_LONGFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_persian_ci);

SELECT
  ST_LONGFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_czech_ci);

SELECT
  ST_LONGFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_unicode_ci);

SELECT
  ST_LONGFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_hungarian_ci);


SELECT
  ST_LATFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_persian_ci);

SELECT
  ST_LATFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_czech_ci);

SELECT
  ST_LATFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_unicode_ci);

SELECT
  ST_LATFROMGEOHASH(
    CAST("0123456789bcdefghjkmnpqrstuvwxyz0123456789BCDEFGHJKMNPQRSTUVWXYZ"
         AS CHAR CHARACTER SET utf8) COLLATE utf8_hungarian_ci);



# This table is for testing functions with DOUBLE values. Literals like 10.2 are
# recognized as DECIMAL.
CREATE TABLE t1 (val DOUBLE);
INSERT INTO t1 (val) VALUES (12.2);
SELECT val INTO @double FROM t1;
DROP TABLE t1;

SET @null = NULL;
SET @geohash = "01bbgcee";
PREPARE stmt FROM "SELECT ST_LONGFROMGEOHASH(?)";
EXECUTE stmt USING @geohash;
DEALLOCATE PREPARE stmt;
SELECT ST_LONGFROMGEOHASH(@geohash);
SELECT ST_LONGFROMGEOHASH(@null);

PREPARE stmt FROM "SELECT ST_LATFROMGEOHASH(?)";
EXECUTE stmt USING @geohash;
DEALLOCATE PREPARE stmt;
SELECT ST_LATFROMGEOHASH(@geohash);
SELECT ST_LATFROMGEOHASH(@null);

DROP TABLE IF EXISTS t1;
CREATE TABLE t1 (a VARCHAR(255));
INSERT INTO t1 (a) VALUES ('  ');
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH(a) FROM t1;
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH(a) FROM t1;

DELETE FROM t1;
INSERT INTO t1 VALUES ('swpwwwwww'), ('guqtjvooguqtjvoo');
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LONGFROMGEOHASH(a) FROM t1;
--error ER_WRONG_VALUE_FOR_TYPE
SELECT ST_LATFROMGEOHASH(a) FROM t1;
--error ER_WRONG_VALUE_FOR_TYPE

--echo # Clean up
DROP TABLE geohashes;

DROP TABLE t1;



SELECT ST_LongFromGeoHash('xkcd');
SELECT ST_LatFromGeoHash('xkcd');
SELECT ST_LatFromGeoHash('m7s9pyctu9bbwqkgbw5x6vutzkztd9szjh86gmz9w9nsz6792d');

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
DO ST_Disjoint(
  POLYGON(
    LINESTRING(POINT(1, 1))
  ),
  ST_LatFromGeoHash(ExtractValue(1, NULL))
);

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
DO ST_Disjoint(
  POLYGON(
    LINESTRING(POINT(1, 1))
  ),
  ST_LongFromGeoHash(ExtractValue(1, NULL))
);

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
DO ST_Disjoint(
  POLYGON(
    LINESTRING(POINT(1, 1))
  ),
  ST_LatFromGeoHash(UpdateXML(1, NULL, NULL))
);

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
DO ST_Disjoint(
  POLYGON(
    LINESTRING(POINT(1, 1))
  ),
  ST_LongFromGeoHash(UpdateXML(1, NULL, NULL))
);




CREATE TABLE t1 (col1 CHAR(4));
INSERT INTO t1 VALUES ('bbbb');
SELECT ST_LatFromGeohash(col1) FROM t1;
SELECT ST_LongFromGeohash(col1) FROM t1;
DROP TABLE t1;

--echo #
--echo # End of 11.5 tests
--echo #
